<div class="container my-5 admin-dashboard">
  <!-- Title -->
  <h1 class="mb-4 text-center text-success fw-bold">Tableau de bord Admin</h1>

  <!-- Welcome -->
  <p class="text-center text-muted">
    Bienvenue, <strong><%= current_user.email %></strong> ğŸ‘‹
  </p>

  <!-- Stats -->
  <div class="row mb-4 stats-row text-center">
    <div class="col-md-4 stat-card">
      <div class="stat-label">Utilisateurs</div>
      <div class="stat-number"><%= @total_users %></div>
    </div>
    <div class="col-md-4 stat-card">
      <div class="stat-label">Admins</div>
      <div class="stat-number"><%= @total_admins %></div>
    </div>
    <div class="col-md-4 stat-card">
      <div class="stat-label">Rendez-vous</div>
      <div class="stat-number"><%= @total_appointments %></div>
    </div>
  </div>

  <!-- User and appointment -->
  <div class="row mt-4">

    <!-- Users -->
    <div class="col-md-6">
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-success text-white fw-bold text-center">
          ğŸ‘¥ Utilisateurs
        </div>
        <ul class="list-group list-group-flush">
          <% @users.each do |user| %>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>
                <%= user.email %>
                <% if user.admin? %>
                  <span class="badge bg-warning text-dark ms-2">Admin</span>
                <% end %>
              </span>
              <% unless user == current_user %>
                <%= button_to (user.admin? ? "RÃ©trograder" : "Promouvoir"),
                              admin_toggle_admin_user_path(user),
                              method: :patch,
                              class: "btn btn-outline-success btn-sm" %>
              <% else %>
                <span class="text-muted small">Vous</span>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>

<!-- Appointments -->
    <div class="col-md-6">
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-primary text-white fw-bold text-center">
          ğŸ“… Rendez-vous
        </div>
        <ul class="list-group list-group-flush">
          <% @appointments.each do |appt| %>
            <li class="list-group-item d-flex justify-content-between align-items-center"
                onclick="window.location='<%= appointment_path(appt) %>'" 
                style="cursor: pointer;">
              <div>
                <strong><%= appt.date.strftime("%d/%m/%Y") %></strong> â€”
                <%= appt.start_time&.strftime("%H:%M") || "Non prÃ©cisÃ©e" %>
                <span class="text-muted small">(<%= appt.user.email %>)</span>
              </div>

              <!-- Badges + buttons -->
              <div class="d-flex align-items-center gap-2">
                <span class="badge
                  <%= case appt.status
                      when "pending" then "bg-warning text-dark"
                      when "confirmed" then "bg-success"
                      when "completed" then "bg-secondary"
                      else "bg-info text-dark"
                      end %>">
                  <%= appt.status.capitalize %>
                </span>

                <% if appt.status == "pending" %>
                  <%= button_to "Confirmer", update_status_appointment_path(appt, status: "confirmed"),
                        method: :patch, class: "btn btn-outline-success btn-sm", form: { data: { turbo: false } } %>
                <% elsif appt.status == "confirmed" %>
                  <%= button_to "Terminer", update_status_appointment_path(appt, status: "completed"),
                        method: :patch, class: "btn btn-outline-secondary btn-sm", form: { data: { turbo: false } } %>
                <% end %>
              </div>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>
